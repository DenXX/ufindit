{% extends 'serp.html' %}

{% block searchform %}
    <form class="navbar-form" method="GET">
      {% csrf_token %}
      <div class="input-append">
        <input type="text" value="{{ query }}" id="queryText" name="q" size="60" autocomplete="off">
        <button type="submit" class="btn btn-success" id="search" data-loading-text="Searching...">Search</button>
        <button type="button" data-toggle="modal" id="queryDifficultyButton" href="#queryDifficulty" class="btn btn-warning">I can't find the answer!</button>
      </div>
    </form>
{% endblock %}

{% block extracode %}
  <!-- Modal -->
  <div class="modal fade" id="queryDifficulty" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
          <h4 class="modal-title">What exactly didn't you like about the search results?</h4>
        </div>
        <div class="modal-body">
          <form class="form-horizontal" id="queryDifficultyForm">
            <input type="hidden" name="serpid" value="{{ serpid }}">
            <input type="hidden" id="openTimer" name="openTimer" value="0">
            <fieldset>
            <!-- Multiple Checkboxes -->
            <div class="control-group">
              <div class="controls">
                <div class="checkbox">
                  <label for="query_difficulty-0">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-0" value="There are documents relevant to the query, but I can get better results by rephrasing my query.">
                      <strong>There are documents relevant</strong> to the query, but I can get better results by rephrasing my query.
                  </label>
                </div>
                <div class="checkbox">
                  <label for="query_difficulty-1">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-1" value="Documents are missing main topic of the query">
                      Documents <strong>missed</strong> the main topic of the query.
                  </label>
                </div>
                <div class="checkbox">
                  <label for="query_difficulty-6">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-6" value="Documents are about different interpretation of the main topic of the query.">
                      Documents are about <strong>different interpretation</strong> of the main topic of the query.
                  </label>
                </div>
                <div class="checkbox">
                  <label for="query_difficulty-2">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-2" value="Documents are missing some aspect (some characteristic of interest) of the main topic of the query.">
                      Documents are missing some <strong>aspect</strong> (some characteristic of interest) of the main topic of the query.
                  </label>
                 </div>
                <div class="checkbox">
                  <label for="query_difficulty-3">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-3" value="This is a complex query asking about several things and documents missed one of the topics.">
                      This is a complex query asking about several things and documents <strong>missed</strong> one of the topics.
                  </label>
                </div>
                <div class="checkbox">
                  <label for="query_difficulty-7">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-7" value="This is a complex query asking about several things, but documents are about different interpretation of one of the topics.">
                      This is a complex query asking about several things, but documents are about <strong>different interpretation</strong> of one of the topics.
                  </label>
                </div>
                <div class="checkbox">
                  <label for="query_difficulty-4">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-4" value="This is a complex query asking about several things and documents missed aspect (some characteristic of interest) of one of the topics.">
                      This is a complex query asking about several things and documents missed <strong>aspect</strong> (some characteristic of interest) of one of the topics.
                  </label>
                </div>
                <div class="checkbox">
                  <label for="query_difficulty-5">
                    <input type="checkbox" name="query_difficulty" id="query_difficulty-5" value="This is a complex query asking about several things and relationship between topics are missing.">
                      This is a complex query asking about several things and <strong>relationship</strong> between topics are missing.
                  </label>
                </div>
                <br />
                <div class="textarea">
                  <textarea rows="3" name="other_reason" class="form-control" id="queryDifficultyTextarea" placeholder="Other reason..."></textarea>
                </div>
              </div>
            </div>

            </fieldset>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="button" id="queryDifficultySubmit" class="btn btn-primary">Submit</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
  <script language="javascript">
    {% if query %}
    var timer;

    function incrementTimer() {
        var cur = parseInt($("#openTimer").val());
        $("#openTimer").val(cur + 1);
    }

    $(document).ready(function() {
        $('#search').hide();
        $('#queryText').prop('disabled', true);

        // Query difficulty window timer
        $('#queryDifficulty').on('shown.bs.modal', function() {
            timer = setInterval(incrementTimer, 1000);
        });
        $('#queryDifficulty').on('hidden.bs.modal', function() {
            clearInterval(timer);
        });

        // onclick for query difficulty
        $('#queryDifficultySubmit').on('click', function () {
            var empty = $('#queryDifficultyTextarea').val() == "";
            empty = empty && $(':checkbox:checked').length == 0;
            if (empty) {
                alert("Please choose one or more options before continuing.");
            }
            else {
                $.post("{% url 'querydifficulty:submit_query_difficulty' task_id=task_id %}", 
                    $('#queryDifficultyForm').serialize());
                $('#queryDifficulty').modal('hide');
                $('#queryText').prop('disabled', false);
                $('#queryDifficultyButton').hide();
                $('#search').show();
            }
        });

    });
    {% else %}
    $('#queryDifficultyButton').hide();
    {% endif %}
  </script>
{% endblock %}